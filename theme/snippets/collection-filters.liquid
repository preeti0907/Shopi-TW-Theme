{% comment %}
  collection-filters.liquid
  This snippet handles the filter sidebar rendering and functionality
{% endcomment %}

{% assign collection_filters = collection.filters %}

<div class="filters-wrapper">
  <div class="filters-header flex justify-between items-center mb-4">
    <h3 class="text-lg font-medium">Filters</h3>
    {% if current_tags.size > 0 or search.terms != '' %}
      <a href="{{ collection.url }}" class="text-sm text-blue-600 hover:text-blue-800">Clear all</a>
    {% endif %}
  </div>

  {% if collection_filters.size > 0 %}
    <div class="filters-list space-y-4">
      {% for filter in collection_filters %}
        <div class="filter-item" data-filter-index="{{ forloop.index }}">
          <button 
            class="filter-trigger w-full flex justify-between items-center py-2 border-b border-gray-200 focus:outline-none"
            aria-expanded="false"
            aria-controls="filter-dropdown-{{ forloop.index }}"
          >
            <span class="font-medium">{{ filter.label }}</span>
            <span class="transform transition-transform duration-200">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 11l4-4H4l4 4z"/>
              </svg>
            </span>
          </button>
          
          <div id="filter-dropdown-{{ forloop.index }}" class="filter-dropdown hidden mt-2 bg-white">
            {% case filter.type %}
              {% when 'price_range' %}
                <div class="price-range-filter p-3">
                  <div class="dual-range-slider relative mt-8 mb-6">
                    <div class="slider-track absolute top-0 h-0.5 bg-gray-200"></div>
                    <input 
                      type="range" 
                      id="price-range-min" 
                      class="absolute w-full top-0 cursor-pointer" 
                      min="{{ filter.min_value.value | times: 100 | round | divided_by: 100 }}" 
                      max="{{ filter.max_value.value | times: 100 | round | divided_by: 100 }}" 
                      value="{{ filter.min_value.value | default: filter.range_min | times: 100 | round | divided_by: 100 }}"
                    >
                    <input 
                      type="range" 
                      id="price-range-max" 
                      class="absolute w-full top-0 cursor-pointer" 
                      min="{{ filter.min_value.value | times: 100 | round | divided_by: 100 }}" 
                      max="{{ filter.max_value.value | times: 100 | round | divided_by: 100 }}" 
                      value="{{ filter.max_value.value | default: filter.range_max | times: 100 | round | divided_by: 100 }}"
                    >
                  </div>
                  
                  <div class="flex justify-between">
                    <span id="display-min-price">{{ filter.min_value.value | money }}</span>
                    <span id="display-max-price">{{ filter.max_value.value | money }}</span>
                  </div>
                  
                  <div class="filter-form mt-4">
                    <input type="hidden" name="filter.v.price.gte" id="filter-min-price" value="{{ filter.min_value.value }}">
                    <input type="hidden" name="filter.v.price.lte" id="filter-max-price" value="{{ filter.max_value.value }}">
                    
                    <button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700">
                      Apply
                    </button>
                  </div>
                </div>
                
              {% when 'list' %}
                <div class="filter-options p-3 max-h-60 overflow-y-auto">
                  {% for value in filter.values %}
                    <div class="filter-option py-1.5">
                      <a 
                        href="{{ value.url }}" 
                        class="flex items-center {% if value.active %}font-medium text-blue-600{% endif %}"
                      >
                        <input 
                          type="checkbox" 
                          class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if value.active %}checked{% endif %}
                          id="filter-{{ filter.label | handleize }}-{{ value.label | handleize }}"
                        >
                        <label 
                          for="filter-{{ filter.label | handleize }}-{{ value.label | handleize }}"
                          class="flex-1 text-sm"
                        >
                          {{ value.label }} ({{ value.count }})
                        </label>
                      </a>
                    </div>
                  {% endfor %}
                </div>
                
              {% else %}
                <div class="filter-options p-3 max-h-60 overflow-y-auto">
                  {% for value in filter.values %}
                    <div class="filter-option py-1.5">
                      <a 
                        href="{{ value.url }}" 
                        class="flex items-center {% if value.active %}font-medium text-blue-600{% endif %}"
                      >
                        <input 
                          type="checkbox" 
                          class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if value.active %}checked{% endif %}
                          id="filter-{{ filter.label | handleize }}-{{ value.label | handleize }}"
                        >
                        <label 
                          for="filter-{{ filter.label | handleize }}-{{ value.label | handleize }}"
                          class="flex-1 text-sm"
                        >
                          {{ value.label }}
                        </label>
                      </a>
                    </div>
                  {% endfor %}
                </div>
            {% endcase %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  {% if collection.all_tags.size > 0 %}
    <div class="filter-item mt-4" data-filter-index="tags">
      <button 
        class="filter-trigger w-full flex justify-between items-center py-2 border-b border-gray-200 focus:outline-none"
        aria-expanded="false"
        aria-controls="filter-dropdown-tags"
      >
        <span class="font-medium">Tags</span>
        <span class="transform transition-transform duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 11l4-4H4l4 4z"/>
          </svg>
        </span>
      </button>
      
      <div id="filter-dropdown-tags" class="filter-dropdown hidden mt-2 bg-white">
        <div class="filter-options p-3 max-h-60 overflow-y-auto">
          {% for tag in collection.all_tags %}
            <div class="filter-option py-1.5">
              <a 
                href="{% if current_tags contains tag %}{{ collection.url }}{% else %}{{ collection.url }}/{{ tag | handle }}{% endif %}" 
                class="flex items-center {% if current_tags contains tag %}font-medium text-blue-600{% endif %}"
              >
                <input 
                  type="checkbox" 
                  class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if current_tags contains tag %}checked{% endif %}
                  id="filter-tag-{{ tag | handleize }}"
                >
                <label 
                  for="filter-tag-{{ tag | handleize }}"
                  class="flex-1 text-sm"
                >
                  {{ tag }}
                </label>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
  
  <div class="filter-item mt-4" data-filter-index="sort">
    <button 
      class="filter-trigger w-full flex justify-between items-center py-2 border-b border-gray-200 focus:outline-none"
      aria-expanded="false"
      aria-controls="filter-dropdown-sort"
    >
      <span class="font-medium">Sort by</span>
      <span class="transform transition-transform duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 11l4-4H4l4 4z"/>
        </svg>
      </span>
    </button>
    
    <div id="filter-dropdown-sort" class="filter-dropdown hidden mt-2 bg-white">
      <div class="p-3">
        <select id="sort-select" class="w-full p-2 border border-gray-300 rounded">
          <option value="manual" {% if collection.sort_by == 'manual' %}selected{% endif %}>Featured</option>
          <option value="price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
          <option value="price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
          <option value="title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>Alphabetically: A-Z</option>
          <option value="title-descending" {% if collection.sort_by == 'title-descending' %}selected{% endif %}>Alphabetically: Z-A</option>
          <option value="created-descending" {% if collection.sort_by == 'created-descending' %}selected{% endif %}>Date: Newest to Oldest</option>
          <option value="created-ascending" {% if collection.sort_by == 'created-ascending' %}selected{% endif %}>Date: Oldest to Newest</option>
          <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected{% endif %}>Best Selling</option>
        </select>
      </div>
    </div>
  </div>
</div>