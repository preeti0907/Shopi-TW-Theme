{%- style -%}
  .slideshow {
    position: relative;
    overflow: hidden;
  }

  .slide {
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transition: opacity 0.5s ease-in-out;
  }

  .slide.active {
    opacity: 1;
    position: relative;
  }

  .slide__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .slide__overlay {
    position: absolute;
    pointer-events: none;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.1) 100%);
  }

  .slide__content {
    position: absolute;
    pointer-events: auto;
    max-width: 550px;
  }

  .slide__content--top-left {
    top: 5%;
    left: 5%;
  }

  .slide__content--top-center {
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
  }

  .slide__content--top-right {
    top: 5%;
    right: 5%;
    text-align: right;
  }

  .slide__content--middle-left {
    top: 50%;
    left: 5%;
    transform: translateY(-50%);
  }

  .slide__content--middle-center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  .slide__content--middle-right {
    top: 50%;
    right: 5%;
    transform: translateY(-50%);
    text-align: right;
  }

  .slide__content--bottom-left {
    bottom: 5%;
    left: 5%;
  }

  .slide__content--bottom-center {
    bottom: 5%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
  }

  .slide__content--bottom-right {
    bottom: 5%;
    right: 5%;
    text-align: right;
  }

  .slideshow__controls {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    z-index: 10;
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .slideshow__dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .slideshow__dot.active {
    background-color: white;
  }

  .slideshow__arrows {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    z-index: 10;
    pointer-events: none;
  }

  .slideshow__arrow {
    position: absolute;
    width: 40px;
    height: 40px;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    pointer-events: auto;
    transition: background-color 0.3s ease;
  }

  .slideshow__arrow:hover {
    background-color: rgba(255, 255, 255, 0.9);
  }

  .slideshow__arrow--prev {
    left: 20px;
  }

  .slideshow__arrow--next {
    right: 20px;
  }

  @media screen and (max-width: 768px) {
    .slideshow__arrow {
      width: 32px;
      height: 32px;
    }
  }
{%- endstyle -%}

<section
  id="slideshow-{{ section.id }}"
  class="slideshow relative w-full"
  data-autoplay="{{ section.settings.autoplay }}"
  data-autoplay-speed="{{ section.settings.autoplay_speed | times: 1000 }}"
  data-slideshow
>
  <div class="slideshow__slides">
    {% for block in section.blocks %}
      {% liquid
        assign bs = block.settings
        assign content_position = bs.content_position | default: 'middle-center'
        assign text_color = bs.text_color | default: 'white'
        assign button_style = bs.button_style | default: 'primary'
        assign desktop_image = bs.desktop_image
        assign mobile_image = bs.mobile_image | default: desktop_image
      %}

      <div 
        class="slide {% if forloop.first %}active{% endif %}"
        data-slide="{{ forloop.index0 }}"
        {{ block.shopify_attributes }}
      >
        <!-- Desktop Image (hidden on mobile) -->
        <div class="hidden md:block h-full">
          {% if desktop_image != blank %}
            <img
              src="{{ desktop_image | image_url: width: 1920 }}"
              srcset="
                {{ desktop_image | image_url: width: 480 }} 480w,
                {{ desktop_image | image_url: width: 768 }} 768w,
                {{ desktop_image | image_url: width: 1200 }} 1200w,
                {{ desktop_image | image_url: width: 1600 }} 1600w,
                {{ desktop_image | image_url: width: 1920 }} 1920w
              "
              sizes="100vw"
              alt="{{ desktop_image.alt | escape }}"
              loading="{{ forloop.first | default: 'lazy' }}"
              class="slide__image"
              width="{{ desktop_image.width }}"
              height="{{ desktop_image.height }}"
            >
          {% else %}
            <div class="w-full h-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-500">{{ 'image' | placeholder_svg_tag: 'w-full h-64' }}</span>
            </div>
          {% endif %}
        </div>

        <!-- Mobile Image (hidden on desktop) -->
        <div class="md:hidden h-full">
          {% if mobile_image != blank %}
            <img
              src="{{ mobile_image | image_url: width: 768 }}"
              srcset="
                {{ mobile_image | image_url: width: 375 }} 375w,
                {{ mobile_image | image_url: width: 550 }} 550w,
                {{ mobile_image | image_url: width: 768 }} 768w
              "
              sizes="100vw"
              alt="{{ mobile_image.alt | escape }}"
              loading="{{ forloop.first | default: 'lazy' }}"
              class="slide__image"
              width="{{ mobile_image.width }}"
              height="{{ mobile_image.height }}"
            >
          {% else %}
            <div class="w-full h-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-500">{{ 'image' | placeholder_svg_tag: 'w-full h-64' }}</span>
            </div>
          {% endif %}
        </div>

        {% if section.settings.show_overlay %}
          <div class="slide__overlay"></div>
        {% endif %}

        {% if bs.title != blank or bs.subtitle != blank or bs.description != blank or bs.button_text != blank %}
          <div class="slide__content slide__content--{{ content_position }} p-4 md:p-6">
            {% if bs.subtitle != blank %}
              <p class="text-{{ text_color }} text-sm md:text-base font-medium mb-2 md:mb-3">
                {{ bs.subtitle }}
              </p>
            {% endif %}

            {% if bs.title != blank %}
              <h2 class="text-{{ text_color }} text-2xl md:text-4xl lg:text-5xl font-bold mb-2 md:mb-4">
                {{ bs.title }}
              </h2>
            {% endif %}

            {% if bs.description != blank %}
              <div class="text-{{ text_color }} text-sm md:text-base mb-4 md:mb-6 max-w-prose">
                {{ bs.description }}
              </div>
            {% endif %}

            {% if bs.button_text != blank %}
              <a 
                href="{{ bs.button_link | default: '#' }}" 
                class="inline-block px-6 py-2 md:px-8 md:py-3 rounded-md text-sm md:text-base font-medium transition-all duration-200 
                {% if button_style == 'primary' %}
                  bg-black text-white hover:bg-opacity-80
                {% elsif button_style == 'secondary' %}
                  bg-white text-black hover:bg-opacity-80
                {% elsif button_style == 'outline' %}
                  {% assign hover_text_color = 'black' %}
                  {% if text_color == 'black' %}
                    {% assign hover_text_color = 'white' %}
                  {% endif %}
                  bg-transparent border border-{{ text_color }} text-{{ text_color }} hover:bg-{{ text_color }} hover:text-{{ hover_text_color }}
                {% endif %}"
              >
                {{ bs.button_text }}
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {% if section.blocks.size > 1 %}
    {% if section.settings.show_dots %}
      <div class="slideshow__controls">
        {% for block in section.blocks %}
          <button 
            class="slideshow__dot{% if forloop.first %} active{% endif %}" 
            data-slide-index="{{ forloop.index0 }}" 
            aria-label="{{ 'sections.slideshow.slide' | t }} {{ forloop.index }} {{ 'general.of' | t | default: 'of' }} {{ forloop.length }}"
          ></button>
        {% endfor %}
      </div>
    {% endif %}

    {% if section.settings.show_arrows %}
      <div class="slideshow__arrows">
        <button class="slideshow__arrow slideshow__arrow--prev" data-slide-prev aria-label="{{ 'sections.slideshow.previous_slide' | t }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button class="slideshow__arrow slideshow__arrow--next" data-slide-next aria-label="{{ 'sections.slideshow.next_slide' | t }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    {% endif %}
  {% endif %}
</section>

<script>
class MinimalistSlideshow {
  constructor(element) {
    this.slideshow = element;
    this.slides = Array.from(this.slideshow.querySelectorAll('.slide'));
    this.dots = Array.from(this.slideshow.querySelectorAll('.slideshow__dot'));
    this.prevButton = this.slideshow.querySelector('[data-slide-prev]');
    this.nextButton = this.slideshow.querySelector('[data-slide-next]');
    this.currentIndex = 0;
    this.autoplay = this.slideshow.dataset.autoplay === 'true';
    this.autoplaySpeed = parseInt(this.slideshow.dataset.autoplaySpeed) || 5000;
    this.autoplayTimer = null;
    
    this.init();
  }

  init() {
    // Initialize event listeners
    if (this.prevButton) {
      this.prevButton.addEventListener('click', () => this.goToSlide(this.currentIndex - 1));
    }
    
    if (this.nextButton) {
      this.nextButton.addEventListener('click', () => this.goToSlide(this.currentIndex + 1));
    }
    
    this.dots.forEach((dot, index) => {
      dot.addEventListener('click', () => this.goToSlide(index));
    });

    // Start autoplay if enabled
    if (this.autoplay) {
      this.startAutoplay();
      
      // Pause autoplay on hover
      this.slideshow.addEventListener('mouseenter', () => this.pauseAutoplay());
      this.slideshow.addEventListener('mouseleave', () => this.startAutoplay());
    }

    // Update on resize for responsive behavior
    window.addEventListener('resize', () => this.updateSlideHeight());
    
    // Initial setup
    this.updateSlideHeight();
  }

  goToSlide(index) {
    // Handle wrapping
    if (index < 0) {
      index = this.slides.length - 1;
    } else if (index >= this.slides.length) {
      index = 0;
    }
    
    // Update classes
    this.slides[this.currentIndex].classList.remove('active');
    this.slides[index].classList.add('active');
    
    // Update dots if they exist
    if (this.dots.length) {
      this.dots[this.currentIndex].classList.remove('active');
      this.dots[index].classList.add('active');
    }
    
    // Update current index
    this.currentIndex = index;
    
    // Reset autoplay timer
    if (this.autoplay) {
      this.pauseAutoplay();
      this.startAutoplay();
    }

    // Update slide height
    this.updateSlideHeight();
  }

  startAutoplay() {
    if (this.autoplay && !this.autoplayTimer) {
      this.autoplayTimer = setInterval(() => {
        this.goToSlide(this.currentIndex + 1);
      }, this.autoplaySpeed);
    }
  }

  pauseAutoplay() {
    if (this.autoplayTimer) {
      clearInterval(this.autoplayTimer);
      this.autoplayTimer = null;
    }
  }

  updateSlideHeight() {
    // Make slideshow height match the current slide's height
    const activeSlide = this.slides[this.currentIndex];
    const activeImage = activeSlide.querySelector('img.slide__image');
    
    if (activeImage && activeImage.complete) {
      this.setHeight(activeImage);
    } else if (activeImage) {
      // If image isn't loaded yet, wait for it
      activeImage.addEventListener('load', () => this.setHeight(activeImage));
    }
  }

  setHeight(image) {
    // Only apply dynamic height when not using fullscreen mode
    if (!this.slideshow.classList.contains('slideshow--fullscreen')) {
      const ratio = image.naturalHeight / image.naturalWidth;
      const width = image.offsetWidth;
      const height = width * ratio;
      
      // Set minimum height to prevent tiny slideshow on very wide screens
      const minHeight = window.innerWidth < 768 ? 250 : 400;
      this.slideshow.style.height = `${Math.max(height, minHeight)}px`;
    }
  }
}

// Initialize all slideshows on the page
document.addEventListener('DOMContentLoaded', () => {
  const slideshows = document.querySelectorAll('[data-slideshow]');
  slideshows.forEach(slideshow => new MinimalistSlideshow(slideshow));
});
</script>

{% schema %}
{
  "name": "Minimalist Slideshow",
  "tag": "section",
  "class": "section-slideshow",
  "settings": [
    {
      "type": "header",
      "content": "Slideshow Settings"
    },
    {
      "type": "select",
      "id": "height",
      "label": "Slideshow height",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to first image"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large", 
          "label": "Large"
        },
        {
          "value": "fullscreen",
          "label": "Full screen"
        }
      ],
      "default": "adapt"
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Show overlay gradient",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "Show dots",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "header",
      "content": "Advanced"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom classes"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "header",
          "content": "Images"
        },
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop image",
          "info": "1800 x 800px recommended"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "750 x 1000px recommended. If none is set, desktop image will be used."
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "select",
          "id": "content_position",
          "label": "Content position",
          "options": [
            {
              "value": "top-left",
              "label": "Top left"
            },
            {
              "value": "top-center",
              "label": "Top center"
            },
            {
              "value": "top-right",
              "label": "Top right"
            },
            {
              "value": "middle-left",
              "label": "Middle left"
            },
            {
              "value": "middle-center",
              "label": "Middle center"
            },
            {
              "value": "middle-right",
              "label": "Middle right"
            },
            {
              "value": "bottom-left",
              "label": "Bottom left"
            },
            {
              "value": "bottom-center",
              "label": "Bottom center"
            },
            {
              "value": "bottom-right",
              "label": "Bottom right"
            }
          ],
          "default": "middle-center"
        },
        {
          "type": "select",
          "id": "text_color",
          "label": "Text color",
          "options": [
            {
              "value": "white",
              "label": "White"
            },
            {
              "value": "black",
              "label": "Black"
            }
          ],
          "default": "white"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "New Collection"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "select",
          "id": "button_style",
          "label": "Button style",
          "options": [
            {
              "value": "primary",
              "label": "Primary (Black)"
            },
            {
              "value": "secondary",
              "label": "Secondary (White)"
            },
            {
              "value": "outline",
              "label": "Outline"
            }
          ],
          "default": "primary"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Minimalist Slideshow",
      "category": "Image",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}